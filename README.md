# Playground k8s cluster 
The following instructions will help you to create a local k8s cluster into your local machine using [kind](https://kind.sigs.k8s.io)

Before to start you need to install the following CLI: `kind`, `kubectl`, and `helm`.

The cluster will includes the following base components:
- coredns (installed by default by kind)
- nginx ingress
- k8s dashboard

## Create the cluster using Kind
The following command will create the playground k8S cluster with one master and 3 worker nodes.
```
$ kind create cluster --name playground --config ./kind.config
```

After creating a cluster, you can use `kubectl` to interact with it by using the configuration file generated by kind:
```
$ export KUBECONFIG="$(kind get kubeconfig-path)"
$ kubectl cluster-info
$ kubectl get nodes -o wide
$ kubectl get all --all-namespaces
```

## Initialize Helm 
`Tiller` is the server component for `helm`. `Tiller` will be present in the kubernetes cluster and the `helm` CLI talks to it for deploying applications using `helm charts`.
`Helm` will be managing your cluster resources. So we need to add necessary permissions to the `tiller` components which will reside in the cluster `kube-system` namespace.

We need to:
- create a `service account` named `tiller`
- create a `ClusterRoleBinding` with cluster-admin permissions to the `tiller service account`

You start creating these resources using `kubectl`
```
$ kubectl apply -f ./helm/helm-rbac.yaml
```

Then you initialize `helm`. Doing so, a deployment named `tiller-deploy` will be deployed in the `kube-system` namespace.

Initialize `helm` using the following command.
```
$ helm init --service-account=tiller --history-max 300
```

You can check the tiller deployment in the `kube-system` namespace using `kubectl`.
```
$ kubectl -n kube-system get deployment tiller-deploy 
```

## Adding Bitnami Helm Repository
Bitnami charts are carefully engineered, actively maintained and are the quickest and easiest way to deploy containers on a Kubernetes cluster.
```
$ helm repo add bitnami https://charts.bitnami.com/bitnami
$ helm update
```


## Deploy Nginx Ingress using Helm
Execute the following `helm install` command to deploy an `nginx ingress` in the playground cluster inside the `nginx` namespace. 
```
$ helm install bitnami/nginx-ingress-controller \
--name ingress \
--namespace ingress \
--set rbac.create=true
```

## Deploy Kubernetes Dashboard using Helm (TOFIX)
Execute the following `helm install` command to deploy the `kubertenes dashboard` in the playground cluster inside the `kube-public` namespace.

`kube-public` namespace is usally reserved for cluster usage, in case that some resources should be visible and readable publicly throughout the whole cluster. 

```
$ helm install stable/kubernetes-dashboard \
--name dashboard \
--namespace kube-public \
--set rbac.create=true
```
When running `kubectl proxy`, use the following URL in your browser to access the `dashboard` UI.
```
http://localhost:8001/api/v1/namespaces/kube-public/services/https:dashboard-kubernetes-dashboard:https/proxy/
```

## Test ingress deploing the Hello-Kube using yaml (TOFIX)
Execute the following `kubectl apply` command to deploy `hello-kube` applications in the playground. Three instances of the application will be deployed.
```
$ kubectl apply -f ./hello-kube/hello-kube.yaml
```

When running `kubectl proxy`, use the following URL in your browser to access the `hello-kube` UI.
```
http://localhost:8001/api/v1/namespaces/default/services/hello-kube/proxy/
```

The following command will delete the `hello-kube` deployment.
```
$ kubectl delete -f ./hello-kube/hello-kube.yaml
```
